# 本地測試說明

## 服務地址

- **後端 API**: http://127.0.0.1:8080
- **API 文檔**: http://127.0.0.1:8080/docs
- **前端**: http://localhost:3001

## 測試步驟

### 1. 驗證後端運行

訪問 http://127.0.0.1:8080/docs，應該看到 Swagger API 文檔。

### 2. 測試搜索群組功能

#### 方法 1: 通過 API 文檔測試

1. 打開 http://127.0.0.1:8080/docs
2. 找到 `/api/v1/chats/search` 端點
3. 點擊 "Try it out"
4. 輸入測試參數：
   - `q`: `t.me/testgroup` 或群組名稱
   - `tg_id`: 你的 Telegram 用戶 ID（可選）
5. 點擊 "Execute"
6. 查看返回結果

#### 方法 2: 通過前端測試

1. 打開 http://localhost:3001
2. 導航到"發送紅包"頁面
3. 在搜索框中輸入：
   - 群組名稱
   - 或 `t.me/群組username`
4. 查看搜索結果

### 3. 測試搜索用戶功能

#### 通過 API 文檔測試

1. 打開 http://127.0.0.1:8080/docs
2. 找到 `/api/v1/chats/users/search` 端點
3. 輸入測試參數：
   - `q`: `@username` 或用戶名
4. 執行並查看結果

### 4. 測試檢查用戶是否在群組中

1. 找到 `/api/v1/chats/{chat_id}/check` 端點
2. 輸入參數：
   - `chat_id`: 群組 ID（如果是基於鏈接的群組，使用負數 ID）
   - `link`: 群組鏈接（如果是基於鏈接的群組）
   - `tg_id`: 你的 Telegram 用戶 ID
3. 執行並查看結果

## 常見問題

### Q: 後端啟動失敗，提示 InvalidToken

**解決方案**:
1. 檢查 `.env` 文件是否存在於 `C:\hbgm001\.env`
2. 確認文件內容格式正確：
   ```
   BOT_TOKEN=8271541107:AAH1YPO82cRzcwcdY9GEloejvNmpKiAxTrs
   ```
   注意：不要有引號，不要有多餘空格
3. 確認文件編碼為 UTF-8（無 BOM）
4. 重新運行 `啟動完整測試.bat`

### Q: 前端無法連接到後端

**解決方案**:
1. 確認後端正在運行（訪問 http://127.0.0.1:8080/docs）
2. 檢查前端代理配置（`frontend/vite.config.ts`）：
   ```typescript
   proxy: {
     '/api': {
       target: 'http://localhost:8080',
       changeOrigin: true,
     },
   }
   ```
3. 確認後端端口是 8080（檢查 `shared/config/settings.py` 中的 `API_PORT`）

### Q: 搜索群組返回空結果

**可能原因**:
1. Bot 不在群組中（對於需要 Bot 在群組中的群組）
2. 群組沒有公開 username
3. 搜索關鍵詞不匹配

**解決方案**:
- 嘗試使用完整的 `t.me/username` 格式
- 確認 Bot 已加入要搜索的群組
- 檢查後端日誌查看詳細錯誤信息

### Q: 端口被占用

**解決方案**:
1. 查找占用端口的進程：
   ```batch
   netstat -ano | findstr ":8080"
   netstat -ano | findstr ":3001"
   ```
2. 結束進程或修改配置使用其他端口

## 測試用例

### 測試用例 1: 搜索已知群組（Bot 在群組中）

```
GET /api/v1/chats/search?q=群組名稱
```

**預期結果**: 返回群組信息

### 測試用例 2: 搜索 t.me 鏈接（Bot 可能不在群組中）

```
GET /api/v1/chats/search?q=t.me/testgroup
```

**預期結果**: 
- 如果 Bot 在群組中：返回真實群組信息
- 如果 Bot 不在群組中：返回基於鏈接的占位符群組信息（負數 ID）

### 測試用例 3: 搜索用戶

```
GET /api/v1/chats/users/search?q=@username
```

**預期結果**: 返回用戶信息

### 測試用例 4: 檢查用戶是否在群組中

```
GET /api/v1/chats/{chat_id}/check?tg_id=123456789&link=https://t.me/testgroup
```

**預期結果**: 返回 `{"in_group": true/false, "message": "..."}`

## 下一步

1. ✅ 確認後端和前端都已啟動
2. ✅ 測試搜索功能
3. ✅ 驗證結果是否符合預期
4. 如果遇到問題，查看後端日誌和前端控制台

