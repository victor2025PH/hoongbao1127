# 部署說明

## 本地代碼已提交

所有更改已提交到本地倉庫並推送到遠程。

## 服務器部署步驟

### 方法 1: 使用部署腳本（推薦）

1. 將 `deploy-to-server.sh` 上傳到服務器
2. 在服務器上執行：
```bash
chmod +x deploy-to-server.sh
./deploy-to-server.sh
```

### 方法 2: 手動部署

在服務器上執行以下命令：

```bash
# 1. 進入項目目錄
cd /opt/luckyred

# 2. 拉取最新代碼
git pull origin master

# 3. 重啟 API 服務
sudo systemctl restart luckyred-api
sudo systemctl status luckyred-api

# 4. 重啟 Bot 服務
sudo systemctl restart luckyred-bot
sudo systemctl status luckyred-bot

# 5. 構建前端
cd frontend
sudo rm -rf dist
npm run build

# 6. 重載 Nginx
sudo systemctl reload nginx
```

## 測試要點

### 1. 群組搜索功能
- ✅ 搜索群組名稱
- ✅ 搜索群組鏈接（`t.me/xxx`）
- ✅ 搜索用戶名（`@username`）
- ✅ 驗證用戶是否在群組中

### 2. 發送紅包
- ✅ 機器人在群組中：紅包消息自動發送到群組
- ✅ 機器人不在群組中：顯示分享鏈接

### 3. 紅包類型
- ✅ 手氣最佳（Best MVP）
- ✅ 紅包炸彈（Red Packet Bomb）- 需要選擇炸彈數字

## 如果遇到問題

### API 服務無法啟動
```bash
# 查看日誌
sudo journalctl -u luckyred-api -n 50 --no-pager

# 檢查 Python 依賴
cd /opt/luckyred/api
pip install -r requirements.txt
```

### Bot 服務無法啟動
```bash
# 查看日誌
sudo journalctl -u luckyred-bot -n 50 --no-pager

# 檢查配置
cat /opt/luckyred/.env | grep BOT_TOKEN
```

### 前端構建失敗
```bash
# 清理並重新安裝依賴
cd /opt/luckyred/frontend
sudo rm -rf node_modules dist
npm install
npm run build
```

## 新功能說明

### 群組搜索改進
- 支持基於鏈接的群組搜索（即使 Bot 不在群組中）
- 統一搜索接口，同時搜索群組和用戶
- 智能驗證用戶是否在群組中

### 紅包發送改進
- 自動嘗試發送消息到群組
- 如果 Bot 不在群組中，提供分享鏈接
- 用戶可以手動分享紅包到群組

### 用戶體驗優化
- 更友好的錯誤提示
- 多語言支持完善
- 智能引導用戶加入群組或分享鏈接

