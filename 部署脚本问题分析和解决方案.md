# 🔍 一键部署脚本问题分析和解决方案

## ❌ 可能的问题原因

### 1. **项目目录路径不匹配**
**问题**：脚本硬编码了 `/opt/luckyred`，但服务器实际路径可能不同

**症状**：
```bash
❌ 项目目录不存在: /opt/luckyred
   请修改脚本中的 PROJECT_DIR 变量
```

**解决方案**：
- 检查服务器实际项目路径
- 修改脚本中的 `PROJECT_DIR` 变量
- 或使用环境变量

---

### 2. **Git 仓库或分支问题**
**问题**：
- Git 仓库 URL 不正确
- 分支名不匹配（master vs main）
- Git 未初始化或未配置远程仓库

**症状**：
```bash
fatal: not a git repository
fatal: 'origin' does not appear to be a git repository
```

**解决方案**：
- 检查 Git 远程仓库：`git remote -v`
- 确认分支名：`git branch -a`
- 如果未初始化，需要先克隆仓库

---

### 3. **权限不足**
**问题**：脚本需要 root 权限来重启 systemctl 服务

**症状**：
```bash
Failed to restart luckyred-api.service: Access denied
```

**解决方案**：
- 使用 `sudo` 执行脚本
- 或确保当前用户有 systemctl 权限

---

### 4. **虚拟环境不存在**
**问题**：脚本假设虚拟环境已存在，但可能未创建

**症状**：
```bash
⚠️  虚拟环境不存在，跳过API依赖安装
```

**解决方案**：
- 脚本会自动跳过，但需要手动创建虚拟环境
- 或修改脚本自动创建虚拟环境

---

### 5. **服务名称不匹配**
**问题**：systemctl 服务名称可能不同

**症状**：
```bash
⚠️  API服务未运行
```

**解决方案**：
- 检查实际服务名称：`systemctl list-units | grep luckyred`
- 修改脚本中的服务名称

---

### 6. **脚本执行权限**
**问题**：脚本文件没有执行权限

**症状**：
```bash
bash: ./deploy-now.sh: Permission denied
```

**解决方案**：
```bash
chmod +x scripts/sh/deploy-now.sh
```

---

### 7. **依赖工具缺失**
**问题**：服务器缺少必要的工具

**症状**：
```bash
command not found: git
command not found: npm
command not found: python3
```

**解决方案**：
- 安装缺失的工具
- 检查 PATH 环境变量

---

### 8. **网络问题**
**问题**：无法连接到 GitHub 或 npm registry

**症状**：
```bash
fatal: unable to access 'https://github.com/...': Could not resolve host
npm ERR! network timeout
```

**解决方案**：
- 检查网络连接
- 配置代理（如需要）
- 使用镜像源

---

## ✅ 改进的部署脚本

创建一个更智能的脚本，能够：
1. 自动检测项目目录
2. 检查并创建必要的环境
3. 提供详细的错误信息
4. 支持自定义配置

