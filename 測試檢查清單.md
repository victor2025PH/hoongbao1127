# 測試檢查清單

## ✅ 已完成
- [x] 前端頁面可以正常打開
- [x] 後端服務正常運行

## 🔄 正在測試

### 1. 消息面板功能
- [ ] 點擊右上角星星圖標，消息面板是否打開？
- [ ] 消息面板中是否顯示消息列表？
- [ ] 如果沒有消息，是否顯示"暫無消息"提示？

### 2. WebSocket 連接
- [ ] 打開瀏覽器開發者工具（F12）
- [ ] 查看 Console 標籤，是否有 `[WebSocket] Connected` 消息？
- [ ] 查看 Network 標籤，找到 WebSocket 連接，狀態是否為 "101 Switching Protocols"？

### 3. 未讀消息徽章
- [ ] 右上角星星圖標左側是否顯示紅色徽章（如果有未讀消息）？
- [ ] 徽章中的數字是否正確顯示未讀數量？

### 4. 消息操作
- [ ] 點擊消息是否可以查看詳情？
- [ ] 是否可以刪除消息？
- [ ] 如果消息支持回復，是否可以回復？

## 📝 測試步驟

### 步驟 1: 檢查 WebSocket 連接
1. 打開瀏覽器開發者工具（按 F12）
2. 切換到 **Console** 標籤
3. 查看是否有以下日誌：
   - `[WebSocket] Connected` - 連接成功
   - `[NotificationManager] Initialized` - 通知管理器初始化成功
4. 如果看到錯誤，請記錄錯誤信息

### 步驟 2: 測試消息面板
1. 點擊右上角的**星星圖標** ⭐
2. 應該看到消息面板從右側滑出
3. 檢查消息列表是否正常顯示

### 步驟 3: 測試 API（可選）
在瀏覽器控制台執行以下代碼測試 API：

```javascript
// 測試獲取未讀消息數量
fetch('http://localhost:8080/api/v1/messages/unread-count', {
  headers: {
    'X-Telegram-Init-Data': 'user=' + encodeURIComponent(JSON.stringify({id: 6359371231}))
  }
})
.then(r => r.json())
.then(data => {
  console.log('✅ 未讀消息數量:', data);
  if (data.unread_count > 0) {
    console.log('📬 有未讀消息，應該在星星圖標上顯示徽章');
  }
})
.catch(err => console.error('❌ API 錯誤:', err));
```

### 步驟 4: 測試發送消息（需要後端支持）
如果需要測試消息發送，可以通過後端 API 發送測試消息。

## 🐛 常見問題

### 問題 1: WebSocket 連接失敗
**症狀**: 控制台顯示 WebSocket 連接錯誤

**解決方案**:
1. 確認後端服務正在運行（http://localhost:8080）
2. 檢查後端日誌是否有錯誤
3. 確認 initData 是否正確傳遞

### 問題 2: 消息面板無法打開
**症狀**: 點擊星星圖標沒有反應

**解決方案**:
1. 檢查瀏覽器控制台是否有 JavaScript 錯誤
2. 確認 React 組件是否正常渲染
3. 檢查網絡請求是否成功

### 問題 3: 未讀數量不顯示
**症狀**: 星星圖標上沒有紅色徽章

**解決方案**:
1. 確認是否有未讀消息（通過 API 查詢）
2. 檢查前端是否正確獲取未讀數量
3. 確認 React Query 是否正常工作

## 📊 測試結果記錄

請記錄以下信息：

1. **WebSocket 連接狀態**: ✅ / ❌
2. **消息面板打開**: ✅ / ❌
3. **未讀數量顯示**: ✅ / ❌
4. **消息列表顯示**: ✅ / ❌
5. **遇到的錯誤**: （如有）

## 🎯 下一步

測試完成後，可以：
1. 測試紅包領取通知功能
2. 測試餘額變動通知功能
3. 測試雙提示功能（miniapp 和 Telegram）
4. 部署到服務器

