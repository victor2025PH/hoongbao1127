# ğŸš€ ä¸‹ä¸€æ­¥è¡ŒåŠ¨è®¡åˆ’

## âœ… å·²å®Œæˆ

1. âœ… **æ•°æ®åº“è¿ç§»è„šæœ¬**
   - Universal Identity System è¿ç§»
   - Ledger System è¿ç§»
   - SQLiteå…¼å®¹æ€§ä¿®å¤

## ğŸ“‹ ç«‹å³å¼€å§‹ï¼ˆä¼˜å…ˆçº§æœ€é«˜ï¼‰

### Step 1: æ›´æ–°æ•°æ®åº“æ¨¡å‹ï¼ˆ30åˆ†é’Ÿï¼‰

**ç›®æ ‡**ï¼šå°†æ–°è¡¨å’Œæ–°å­—æ®µæ·»åŠ åˆ°SQLAlchemyæ¨¡å‹ä¸­

**éœ€è¦æ›´æ–°çš„æ–‡ä»¶**ï¼š
- `shared/database/models.py`

**éœ€è¦æ·»åŠ çš„æ¨¡å‹**ï¼š
1. `UserIdentity` - ç”¨æˆ·èº«ä»½å…³è”è¡¨
2. `AccountLink` - è´¦æˆ·é“¾æ¥è¡¨
3. `LedgerEntry` - è´¦æœ¬æ¡ç›®è¡¨
4. `UserBalance` - ä½™é¢å¿«ç…§è¡¨

**éœ€è¦æ›´æ–°çš„æ¨¡å‹**ï¼š
1. `User` - æ·»åŠ æ–°å­—æ®µï¼ˆuuid, wallet_address, referrer_idç­‰ï¼‰

**æ‰§è¡Œæ­¥éª¤**ï¼š
```bash
# 1. æ›´æ–°models.py
# 2. æµ‹è¯•æ¨¡å‹å¯¼å…¥
python -c "from shared.database.models import *; print('âœ… Models OK')"
```

---

### Step 2: å®ç°IdentityServiceï¼ˆ1å°æ—¶ï¼‰

**ç›®æ ‡**ï¼šåˆ›å»ºç»Ÿä¸€èº«ä»½è®¤è¯æœåŠ¡

**éœ€è¦åˆ›å»ºçš„æ–‡ä»¶**ï¼š
- `api/services/identity_service.py`

**åŠŸèƒ½**ï¼š
1. `get_or_create_user_by_identity()` - é€šè¿‡èº«ä»½æä¾›è€…è·å–æˆ–åˆ›å»ºç”¨æˆ·
2. `link_identity()` - é“¾æ¥æ–°èº«ä»½åˆ°ç°æœ‰ç”¨æˆ·
3. `generate_magic_link()` - ç”ŸæˆMagic Link
4. `verify_magic_link()` - éªŒè¯Magic Link

---

### Step 3: å®ç°Auth APIè·¯ç”±ï¼ˆ1å°æ—¶ï¼‰

**ç›®æ ‡**ï¼šåˆ›å»ºWebè®¤è¯APIç«¯ç‚¹

**éœ€è¦åˆ›å»ºçš„æ–‡ä»¶**ï¼š
- `api/routers/auth/web.py` - Google OAuth, Walletè¿æ¥
- `api/routers/auth/link.py` - Magic Linkç”Ÿæˆå’ŒéªŒè¯

**APIç«¯ç‚¹**ï¼š
- `POST /api/v1/auth/web/google` - Googleç™»å½•
- `POST /api/v1/auth/web/wallet` - Walletè¿æ¥
- `POST /api/v1/auth/link/magic-link/generate` - ç”ŸæˆMagic Link
- `POST /api/v1/auth/link/magic-link/verify` - éªŒè¯Magic Link

---

### Step 4: å®ç°å‰ç«¯AuthGuardï¼ˆ1å°æ—¶ï¼‰

**ç›®æ ‡**ï¼šåˆ›å»ºå‰ç«¯è®¤è¯å®ˆå«ç»„ä»¶

**éœ€è¦åˆ›å»ºçš„æ–‡ä»¶**ï¼š
- `frontend/src/utils/auth/AuthGuard.tsx`
- `frontend/src/utils/auth/useAuth.ts`
- `frontend/src/components/WebLoginScreen.tsx`
- `frontend/src/utils/platform.ts` - å¹³å°æ£€æµ‹å·¥å…·

**åŠŸèƒ½**ï¼š
1. è‡ªåŠ¨æ£€æµ‹å¹³å°ï¼ˆTelegram/Web/iOS/Androidï¼‰
2. Telegramç¯å¢ƒï¼šè‡ªåŠ¨ç™»å½•
3. Webç¯å¢ƒï¼šæ˜¾ç¤ºç™»å½•é€‰é¡¹ï¼ˆGoogle/Walletï¼‰
4. ç»Ÿä¸€ç”¨æˆ·çŠ¶æ€ç®¡ç†

---

### Step 5: é›†æˆLedgerServiceï¼ˆ1å°æ—¶ï¼‰

**ç›®æ ‡**ï¼šå°†ç°æœ‰ä½™é¢æ“ä½œæ›¿æ¢ä¸ºLedgerService

**éœ€è¦ä¿®æ”¹çš„æ–‡ä»¶**ï¼š
- `api/routers/redpackets.py` - ä½¿ç”¨LedgerServiceåˆ›å»ºè´¦æœ¬æ¡ç›®
- `api/routers/checkin.py` - ä½¿ç”¨LedgerServiceè®°å½•ç­¾åˆ°å¥–åŠ±
- `api/routers/tasks.py` - ä½¿ç”¨LedgerServiceè®°å½•ä»»åŠ¡å¥–åŠ±

**æ›¿æ¢é€»è¾‘**ï¼š
- åŸæ¥ï¼šç›´æ¥æ›´æ–° `user.balance_usdt`
- ç°åœ¨ï¼šä½¿ç”¨ `LedgerService.create_entry()` åˆ›å»ºè´¦æœ¬æ¡ç›®

---

## ğŸ“… æœ¬å‘¨è®¡åˆ’ï¼ˆWeek 1-2ï¼‰

### Day 1-2: æ•°æ®åº“æ¨¡å‹æ›´æ–°
- [ ] æ·»åŠ  `UserIdentity` æ¨¡å‹
- [ ] æ·»åŠ  `AccountLink` æ¨¡å‹
- [ ] æ·»åŠ  `LedgerEntry` æ¨¡å‹
- [ ] æ·»åŠ  `UserBalance` æ¨¡å‹
- [ ] æ›´æ–° `User` æ¨¡å‹
- [ ] æµ‹è¯•æ¨¡å‹å¯¼å…¥å’Œå…³ç³»

### Day 3-4: IdentityServiceå®ç°
- [ ] åˆ›å»º `identity_service.py`
- [ ] å®ç°èº«ä»½è·å–/åˆ›å»ºé€»è¾‘
- [ ] å®ç°èº«ä»½é“¾æ¥é€»è¾‘
- [ ] å®ç°Magic Linkç”Ÿæˆ/éªŒè¯
- [ ] ç¼–å†™å•å…ƒæµ‹è¯•

### Day 5: Auth APIå®ç°
- [ ] åˆ›å»º `auth/web.py` è·¯ç”±
- [ ] å®ç°Google OAuthï¼ˆMockç‰ˆæœ¬ï¼‰
- [ ] å®ç°Walletè¿æ¥ï¼ˆç­¾åéªŒè¯ï¼‰
- [ ] åˆ›å»º `auth/link.py` è·¯ç”±
- [ ] å®ç°Magic Link API

---

## ğŸ¯ å»ºè®®çš„æ‰§è¡Œé¡ºåº

### ç«‹å³æ‰§è¡Œï¼ˆä»Šå¤©ï¼‰

1. **æ›´æ–°æ•°æ®åº“æ¨¡å‹** â­â­â­
   - è¿™æ˜¯åŸºç¡€ï¼Œå…¶ä»–åŠŸèƒ½éƒ½ä¾èµ–å®ƒ
   - é¢„è®¡æ—¶é—´ï¼š30åˆ†é’Ÿ

2. **å®ç°IdentityService** â­â­â­
   - æ ¸å¿ƒæœåŠ¡ï¼Œè¢«å¤šä¸ªAPIä½¿ç”¨
   - é¢„è®¡æ—¶é—´ï¼š1å°æ—¶

3. **å®ç°AuthGuardå‰ç«¯** â­â­
   - ç”¨æˆ·å¯è§çš„åŠŸèƒ½
   - é¢„è®¡æ—¶é—´ï¼š1å°æ—¶

### æ˜å¤©æ‰§è¡Œ

4. **å®ç°Webè®¤è¯API** â­â­
   - æ”¯æŒWebç”¨æˆ·ç™»å½•
   - é¢„è®¡æ—¶é—´ï¼š1å°æ—¶

5. **é›†æˆLedgerService** â­â­â­
   - æ›¿æ¢ç°æœ‰ä½™é¢æ“ä½œ
   - é¢„è®¡æ—¶é—´ï¼š1å°æ—¶

---

## ğŸ’¡ å¿«é€Ÿå¼€å§‹å‘½ä»¤

```bash
# 1. æ›´æ–°æ•°æ®åº“æ¨¡å‹
# ç¼–è¾‘ shared/database/models.py

# 2. æµ‹è¯•æ¨¡å‹
python -c "from shared.database.models import *; print('âœ… OK')"

# 3. åˆ›å»ºIdentityService
# åˆ›å»º api/services/identity_service.py

# 4. åˆ›å»ºAuth API
# åˆ›å»º api/routers/auth/web.py
# åˆ›å»º api/routers/auth/link.py

# 5. æ›´æ–°main.pyæ³¨å†Œæ–°è·¯ç”±
# ç¼–è¾‘ api/main.py
```

---

## ğŸ“ éœ€è¦æˆ‘å¸®ä½ å®ç°å“ªä¸ªéƒ¨åˆ†ï¼Ÿ

æˆ‘å¯ä»¥ç«‹å³å¼€å§‹å®ç°ï¼š
1. âœ… æ›´æ–°æ•°æ®åº“æ¨¡å‹ï¼ˆmodels.pyï¼‰
2. âœ… å®ç°IdentityService
3. âœ… å®ç°Auth APIè·¯ç”±
4. âœ… å®ç°å‰ç«¯AuthGuard

å‘Šè¯‰æˆ‘ä½ æƒ³å…ˆåšå“ªä¸ªï¼Œæˆ‘ä¼šç«‹å³å¼€å§‹ï¼

