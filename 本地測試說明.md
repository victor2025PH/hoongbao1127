# 本地測試說明

## 📊 當前狀態

### ✅ 代碼檢查完成

1. **文件存在**:
   - ✅ `api/routers/chats.py` 存在
   - ✅ `api/main.py` 存在

2. **路由註冊**:
   - ✅ `chats` 路由已導入
   - ✅ `chats` 路由已註冊

3. **搜索函數**:
   - ✅ `search_chats` 函數存在

---

## 🚀 測試步驟

### 步驟 1: 啟動 API 服務器

**已在後台啟動**，如果沒有自動啟動，請手動執行：

```powershell
cd C:\hbgm001\api
python -m uvicorn main:app --reload --host 127.0.0.1 --port 8000
```

**預期輸出**:
```
INFO:     Uvicorn running on http://127.0.0.1:8000
INFO:     Application startup complete.
```

---

### 步驟 2: 測試 API 端點

**在瀏覽器中打開**:
```
http://localhost:8000/api/v1/chats/search?q=minihb2
```

**或使用 curl**:
```powershell
curl http://localhost:8000/api/v1/chats/search?q=minihb2
```

**預期響應**:
```json
[
  {
    "id": -123456789,
    "title": "@minihb2",
    "type": "group",
    "link": "https://t.me/minihb2"
  }
]
```

---

### 步驟 3: 啟動前端服務器

**在新的終端窗口中執行**:

```powershell
cd C:\hbgm001\frontend
npm run dev
```

**預期輸出**:
```
VITE v5.x.x  ready in xxx ms

➜  Local:   http://localhost:3001/
```

---

### 步驟 4: 測試前端功能

1. **打開瀏覽器**: `http://localhost:3001`
2. **進入"發紅包"頁面**
3. **點擊"選擇群組"**
4. **輸入**: `https://t.me/minihb2`
5. **驗證搜索結果**

---

## 🔍 問題診斷

### 如果 API 返回 404

**檢查項目**:
1. 服務器是否正常啟動
2. 查看服務器終端的錯誤信息
3. 檢查路由是否正確註冊

**檢查命令**:
```powershell
# 檢查服務器日誌
# 查看啟動終端的輸出
```

---

### 如果 API 返回空數組 []

**檢查項目**:
1. 搜索邏輯是否正確執行
2. 查看服務器日誌中的搜索記錄
3. 檢查代碼邏輯

**檢查代碼**:
```python
# api/routers/chats.py
# 第 167-176 行應該有：
# if len(chats) == 0 and username_from_link:
#     # 創建 placeholder 群組
```

---

### 如果前端顯示"未找到群组"

**檢查項目**:
1. 打開瀏覽器開發者工具 (F12)
2. 查看 Network 標籤
3. 找到 `/api/v1/chats/search` 請求
4. 檢查：
   - 請求 URL 是否正確
   - 響應狀態碼（應該是 200）
   - 響應內容（應該包含群組列表）

---

## 📋 測試檢查清單

### API 測試
- [ ] 服務器正常啟動
- [ ] 路由 `/api/v1/chats/search` 可訪問
- [ ] 搜索 `minihb2` 返回結果
- [ ] 搜索 `https://t.me/minihb2` 返回結果
- [ ] 返回的數據格式正確

### 前端測試
- [ ] 前端服務器正常啟動
- [ ] 可以打開"發紅包"頁面
- [ ] 可以打開"選擇群組"彈窗
- [ ] 輸入搜索關鍵詞後有響應
- [ ] 搜索結果正確顯示
- [ ] 不顯示"未找到群组"

---

## 🔧 常見問題

### 問題 1: 服務器啟動失敗

**錯誤**: `ModuleNotFoundError: No module named 'api.routers.chats'`

**解決方案**:
```powershell
# 確保在 api 目錄下運行
cd C:\hbgm001\api
python -m uvicorn main:app --reload
```

---

### 問題 2: 端口被占用

**錯誤**: `Address already in use`

**解決方案**:
```powershell
# 使用其他端口
python -m uvicorn main:app --reload --port 8001
```

---

### 問題 3: API 返回 404

**檢查**:
```python
# 確認 api/main.py 中有：
from api.routers import chats
app.include_router(chats.router, prefix="/api/v1/chats")
```

---

## 🎯 下一步

1. ✅ 檢查 API 服務器是否啟動
2. ✅ 測試 API 端點
3. ✅ 啟動前端服務器
4. ✅ 測試前端功能
5. ✅ 檢查瀏覽器控制台
6. ✅ 查看服務器日誌

---

**本地測試準備完成！請按照上述步驟進行測試。**

