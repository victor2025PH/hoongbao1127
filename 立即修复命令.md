# ğŸš¨ ç«‹å³ä¿®å¤å‘½ä»¤ï¼ˆåœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œï¼‰

## é—®é¢˜
- Gitå†²çªå¯¼è‡´ä»£ç æœªæ›´æ–°
- APIè·¯ç”±è¿”å›404ï¼ˆè™½ç„¶ä»£ç ä¸­å·²æ³¨å†Œï¼‰
- Botå†²çªæ£€æµ‹

## å¿«é€Ÿä¿®å¤ï¼ˆå¤åˆ¶ç²˜è´´æ‰§è¡Œï¼‰

```bash
cd /opt/luckyred

# 1. è§£å†³Gitå†²çªå¹¶æ›´æ–°ä»£ç 
git stash
git pull origin master
git stash pop || true

# 2. æ£€æŸ¥è·¯ç”±æ˜¯å¦æ³¨å†Œ
grep -n "tasks" api/main.py

# 3. æµ‹è¯•tasksæ¨¡å—èƒ½å¦å¯¼å…¥
cd /opt/luckyred/api
source .venv/bin/activate
python3 -c "from api.routers import tasks; print('OK')" || {
    echo "å®‰è£…ä¾èµ–..."
    pip install -q sqlalchemy psycopg2-binary fastapi uvicorn
}

# 4. åœæ­¢Botï¼ˆè§£å†³å†²çªï¼‰
sudo systemctl stop luckyred-bot
sleep 2

# 5. é‡å¯APIæœåŠ¡ï¼ˆé‡è¦ï¼ï¼‰
sudo systemctl restart luckyred-api
sleep 5

# 6. é‡å¯BotæœåŠ¡
sudo systemctl restart luckyred-bot
sleep 3

# 7. æµ‹è¯•APIè·¯ç”±
curl -I http://localhost:8080/api/v1/tasks/status
# åº”è¯¥è¿”å› 401 (éœ€è¦è®¤è¯) æˆ– 200ï¼Œä¸æ˜¯ 404

# 8. æ£€æŸ¥æœåŠ¡çŠ¶æ€
sudo systemctl status luckyred-api --no-pager | head -10
sudo systemctl status luckyred-bot --no-pager | head -10
```

## æˆ–è€…ä½¿ç”¨ä¿®å¤è„šæœ¬

```bash
cd /opt/luckyred
git pull origin master
chmod +x scripts/sh/fix-git-and-restart.sh
bash scripts/sh/fix-git-and-restart.sh
```

## å¦‚æœAPIä»ç„¶è¿”å›404

æ£€æŸ¥APIæœåŠ¡æ—¥å¿—ï¼š

```bash
# æŸ¥çœ‹æœ€è¿‘çš„é”™è¯¯æ—¥å¿—
sudo journalctl -u luckyred-api -n 50 | grep -i error

# æŸ¥çœ‹APIå¯åŠ¨æ—¥å¿—
sudo journalctl -u luckyred-api -n 100 | grep -i "start\|error\|import"

# æ‰‹åŠ¨æµ‹è¯•å¯¼å…¥
cd /opt/luckyred/api
source .venv/bin/activate
python3 -c "
import sys
sys.path.insert(0, '/opt/luckyred')
from api.routers import tasks
print('å¯¼å…¥æˆåŠŸ')
print(f'è·¯ç”±: {len(tasks.router.routes)}')
"
```

## éªŒè¯

```bash
# 1. æµ‹è¯•APIè·¯ç”±
curl http://localhost:8080/api/v1/tasks/status
# åº”è¯¥è¿”å› JSON æˆ– 401

# 2. è®¿é—®ä»»åŠ¡é¡µé¢
# æµè§ˆå™¨æ‰“å¼€: https://mini.usdt2026.cc/tasks

# 3. æŸ¥çœ‹å®æ—¶æ—¥å¿—
sudo journalctl -u luckyred-api -f
```

