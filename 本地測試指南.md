# 本地測試指南

## 📊 測試準備

### 步驟 1: 檢查本地文件

**檢查項目**:
- ✅ `api/routers/chats.py` 是否存在
- ✅ `api/main.py` 是否存在
- ✅ 路由是否正確註冊

---

### 步驟 2: 啟動本地 API 服務器

#### 方法 1: 直接使用 Python

```powershell
cd C:\hbgm001\api
python -m uvicorn main:app --reload --host 127.0.0.1 --port 8000
```

#### 方法 2: 使用虛擬環境

```powershell
cd C:\hbgm001\api
.venv\Scripts\activate
uvicorn main:app --reload --host 127.0.0.1 --port 8000
```

---

### 步驟 3: 啟動前端開發服務器

**在新的終端窗口中執行**:

```powershell
cd C:\hbgm001\frontend
npm run dev
```

---

### 步驟 4: 測試 API 端點

#### 測試搜索群組 API

**使用 curl**:
```powershell
curl -X GET "http://localhost:8000/api/v1/chats/search?q=minihb2" -H "Content-Type: application/json"
```

**使用瀏覽器**:
```
http://localhost:8000/api/v1/chats/search?q=minihb2
```

**預期響應**:
```json
[
  {
    "id": -123456789,
    "title": "@minihb2",
    "type": "group",
    "link": "https://t.me/minihb2"
  }
]
```

---

### 步驟 5: 測試前端功能

1. **打開瀏覽器**: `http://localhost:3001` (或前端開發服務器顯示的端口)
2. **進入"發紅包"頁面**
3. **點擊"選擇群組"**
4. **輸入**: `https://t.me/minihb2`
5. **驗證搜索結果**

---

## 🔍 問題診斷

### 如果 API 返回 404

**檢查項目**:
1. 服務器是否正常啟動
2. 路由是否正確註冊
3. 查看服務器日誌

**檢查命令**:
```powershell
# 檢查服務器日誌
# 查看終端輸出中的錯誤信息
```

---

### 如果 API 返回空數組

**檢查項目**:
1. 搜索邏輯是否正確
2. 查看服務器日誌中的搜索記錄

**檢查代碼**:
```python
# api/routers/chats.py
# 檢查 search_chats 函數
# 應該至少返回一個基於鏈接的群組
```

---

### 如果前端顯示"未找到群组"

**檢查項目**:
1. 瀏覽器控制台的網絡請求
2. API 是否返回正確的數據
3. 前端是否正確處理響應

**檢查方法**:
1. 打開瀏覽器開發者工具 (F12)
2. 查看 Network 標籤
3. 找到 `/api/v1/chats/search` 請求
4. 檢查請求狀態和響應內容

---

## 📋 測試檢查清單

### API 測試
- [ ] 服務器正常啟動
- [ ] 路由 `/api/v1/chats/search` 可訪問
- [ ] 搜索 `minihb2` 返回結果
- [ ] 搜索 `https://t.me/minihb2` 返回結果
- [ ] 返回的數據格式正確

### 前端測試
- [ ] 前端服務器正常啟動
- [ ] 可以打開"發紅包"頁面
- [ ] 可以打開"選擇群組"彈窗
- [ ] 輸入搜索關鍵詞後有響應
- [ ] 搜索結果正確顯示
- [ ] 不顯示"未找到群组"

---

## 🔧 常見問題

### 問題 1: 服務器啟動失敗

**錯誤**: `ModuleNotFoundError: No module named 'api.routers.chats'`

**解決方案**:
```powershell
# 檢查文件是否存在
ls api/routers/chats.py

# 檢查導入路徑
# 確保在 api 目錄下運行
cd C:\hbgm001\api
```

---

### 問題 2: 路由未註冊

**錯誤**: API 返回 404

**解決方案**:
```python
# 檢查 api/main.py
# 應該有:
from api.routers import chats
app.include_router(chats.router, prefix="/api/v1/chats")
```

---

### 問題 3: 搜索返回空數組

**原因**: 搜索邏輯有問題

**解決方案**:
```python
# 檢查 api/routers/chats.py
# search_chats 函數應該:
# 1. 處理 t.me 鏈接
# 2. 至少返回一個基於鏈接的群組
```

---

## 🎯 測試步驟總結

1. ✅ 檢查本地文件
2. ✅ 啟動 API 服務器
3. ✅ 啟動前端服務器
4. ✅ 測試 API 端點
5. ✅ 測試前端功能
6. ✅ 檢查瀏覽器控制台
7. ✅ 查看服務器日誌

---

**請按照上述步驟進行本地測試，找出問題所在！**

