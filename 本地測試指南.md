# 本地開發環境測試指南

## 🚀 啟動服務

### 方式一：使用啟動腳本（推薦）

```bash
# PowerShell
.\start-local-dev.ps1

# 或批處理
.\start-local-dev.bat
```

### 方式二：手動啟動

#### 1. 啟動 API 服務器

```bash
# 激活虛擬環境
cd api
.venv\Scripts\Activate.ps1  # PowerShell
# 或
.venv\Scripts\activate.bat   # CMD

# 啟動服務器
python main.py
```

API 將在 `http://localhost:8080` 運行

#### 2. 啟動前端開發服務器

```bash
cd frontend
npm run dev
```

前端將在 `http://localhost:3001` 運行

## 📋 測試步驟

### 1. 訪問前端
打開瀏覽器訪問：`http://localhost:3001`

### 2. 測試遊戲規則彈窗
1. 進入 Wallet 頁面（點擊底部導航的「錢包」）
2. 點擊「發紅包」按鈕
3. **應該自動彈出遊戲規則彈窗**

### 3. 檢查功能
- [ ] 彈窗標題顯示「✨ 遊戲規則 ✨」
- [ ] 標題有發光特效
- [ ] 規則內容使用加密貨幣（USDT, TON, STARS, POINTS）
- [ ] 有「以後不再彈出」選擇框
- [ ] 按鈕顯示「✨ 遊戲規則 ✨」
- [ ] 按鈕懸停時有發光特效

### 4. 測試「以後不再彈出」功能
1. 勾選「以後不再彈出」選擇框
2. 點擊「我知道了」關閉彈窗
3. 刷新頁面或重新進入發送紅包頁面
4. **應該不再自動彈出彈窗**

### 5. 清除設置重新測試
打開瀏覽器開發者工具（F12），在 Console 中執行：
```javascript
localStorage.removeItem('dont_show_game_rules')
```
然後刷新頁面，彈窗應該重新顯示。

## 🔧 配置要求

### .env 文件配置

確保 `.env` 文件包含以下配置：

```env
# API 配置
API_HOST=127.0.0.1
API_PORT=8080
API_BASE_URL=http://localhost:8080

# 數據庫（本地測試可以使用 SQLite 或 PostgreSQL）
DATABASE_URL=postgresql://user:password@localhost:5432/luckyred

# Telegram Bot（可選，僅測試前端時不需要）
BOT_TOKEN=your_bot_token_here

# 調試模式
DEBUG=true
LOG_LEVEL=DEBUG
```

## 🐛 常見問題

### 問題 1: API 服務器無法啟動

**檢查：**
- Python 虛擬環境是否已創建
- 依賴是否已安裝：`pip install -r requirements.txt`
- 端口 8080 是否被佔用

**解決：**
```bash
# 檢查端口
netstat -ano | findstr :8080

# 如果被佔用，修改 .env 中的 API_PORT
```

### 問題 2: 前端無法連接 API

**檢查：**
- API 服務器是否正在運行
- `vite.config.ts` 中的 proxy 配置是否正確

**解決：**
- 確認 API 在 `http://localhost:8080` 運行
- 檢查瀏覽器控制台的錯誤信息

### 問題 3: 看不到新功能

**檢查：**
- 瀏覽器緩存（本地開發通常會自動刷新）
- 檢查開發者工具中的錯誤

**解決：**
- 強制刷新：`Ctrl + Shift + R`
- 清除 localStorage：`localStorage.clear()`

## 📊 測試檢查清單

### 前端功能
- [ ] 頁面可以正常加載
- [ ] 可以進入發送紅包頁面
- [ ] 遊戲規則彈窗自動顯示
- [ ] 彈窗內容正確（加密貨幣說明）
- [ ] 按鈕顯示正確（✨ 遊戲規則 ✨）
- [ ] 發光特效正常
- [ ] 「以後不再彈出」功能正常

### API 功能
- [ ] API 服務器正常啟動
- [ ] 可以訪問 `http://localhost:8080/docs`
- [ ] API 端點正常響應

## 🎯 測試重點

重點測試以下功能：

1. **遊戲規則彈窗自動顯示**
   - 首次進入發送紅包頁面時應該自動彈出
   - 彈窗內容應該使用加密貨幣說明

2. **按鈕美化**
   - 按鈕文字應該是「✨ 遊戲規則 ✨」
   - 懸停時應該有發光特效

3. **不再彈出功能**
   - 勾選後應該保存到 localStorage
   - 再次進入時不應該彈出

## 📝 注意事項

1. **數據庫連接**：確保數據庫服務正在運行
2. **端口衝突**：確保 8080 和 3001 端口未被佔用
3. **環境變量**：確保 `.env` 文件配置正確
4. **依賴安裝**：確保所有依賴都已正確安裝
