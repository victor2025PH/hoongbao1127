# æœå‹™å™¨è¨ºæ–·å’Œä¿®å¾©æŒ‡å—

## ğŸ“Š å•é¡Œåˆ†æ

å¾çµ‚ç«¯è¼¸å‡ºå¯ä»¥çœ‹åˆ°ï¼š

### å•é¡Œ 1: ä¸åœ¨æ­£ç¢ºçš„ç›®éŒ„
```
ubuntu@10-11-156-159:~$ api/routers/chats.py
-bash: api/routers/chats.py: No such file or directory
```

**åŸå› **: ç•¶å‰åœ¨ `~` (å®¶ç›®éŒ„)ï¼Œæ‡‰è©²åœ¨ `/opt/luckyred` ç›®éŒ„ä¸‹ã€‚

### å•é¡Œ 2: æ–‡ä»¶ä¸å­˜åœ¨
```
grep: api/main.py: No such file or directory
```

**åŸå› **: ä¸åœ¨é …ç›®ç›®éŒ„ä¸­ï¼Œæ‰€ä»¥æ‰¾ä¸åˆ°æ–‡ä»¶ã€‚

### å•é¡Œ 3: å‘½ä»¤åŸ·è¡ŒéŒ¯èª¤
```
sudo systemctl status luckyred-apisudo journalctl -u luckyred-api -n 50
systemctl: invalid option -- 'u'
```

**åŸå› **: å…©å€‹å‘½ä»¤è¢«é€£åœ¨ä¸€èµ·äº†ï¼Œæ‡‰è©²åˆ†é–‹åŸ·è¡Œã€‚

---

## âœ… æ­£ç¢ºçš„åŸ·è¡Œæ­¥é©Ÿ

### æ­¥é©Ÿ 1: åˆ‡æ›åˆ°é …ç›®ç›®éŒ„

```bash
cd /opt/luckyred
pwd  # ç¢ºèªç•¶å‰ç›®éŒ„
```

### æ­¥é©Ÿ 2: æª¢æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨

```bash
ls -la api/routers/chats.py
ls -la api/main.py
```

### æ­¥é©Ÿ 3: æª¢æŸ¥è·¯ç”±è¨»å†Š

```bash
grep -n "chats" api/main.py
```

### æ­¥é©Ÿ 4: å¦‚æœæ–‡ä»¶ä¸å­˜åœ¨ï¼Œæ›´æ–°ä»£ç¢¼

```bash
git fetch origin
git reset --hard origin/master
ls -la api/routers/chats.py  # å†æ¬¡ç¢ºèªæ–‡ä»¶å­˜åœ¨
```

### æ­¥é©Ÿ 5: æª¢æŸ¥æœå‹™ç‹€æ…‹

```bash
sudo systemctl status luckyred-api
```

### æ­¥é©Ÿ 6: æª¢æŸ¥æœå‹™æ—¥èªŒ

```bash
sudo journalctl -u luckyred-api -n 50 | grep -i "search\|chats\|minihb2"
```

### æ­¥é©Ÿ 7: å¦‚æœæ–‡ä»¶å­˜åœ¨ä½†æœå‹™æœªé‹è¡Œï¼Œé‡å•Ÿæœå‹™

```bash
sudo systemctl restart luckyred-api
sleep 3
sudo systemctl status luckyred-api
```

---

## ğŸ”§ å®Œæ•´ä¿®å¾©å‘½ä»¤ï¼ˆä¸€æ¬¡æ€§åŸ·è¡Œï¼‰

```bash
# 1. åˆ‡æ›åˆ°é …ç›®ç›®éŒ„
cd /opt/luckyred

# 2. æª¢æŸ¥ç•¶å‰æäº¤
git log --oneline -1

# 3. æ›´æ–°ä»£ç¢¼
git fetch origin
git reset --hard origin/master

# 4. é©—è­‰æ–‡ä»¶å­˜åœ¨
echo "=== æª¢æŸ¥ chats.py ==="
ls -lh api/routers/chats.py

echo "=== æª¢æŸ¥è·¯ç”±è¨»å†Š ==="
grep -n "chats" api/main.py

# 5. é‡å•Ÿæœå‹™
echo "=== é‡å•Ÿæœå‹™ ==="
sudo systemctl restart luckyred-api
sleep 3

# 6. æª¢æŸ¥æœå‹™ç‹€æ…‹
echo "=== æœå‹™ç‹€æ…‹ ==="
sudo systemctl status luckyred-api --no-pager | head -15

# 7. æª¢æŸ¥æœå‹™æ—¥èªŒ
echo "=== æœå‹™æ—¥èªŒï¼ˆæœ€å¾Œ 20 è¡Œï¼‰==="
sudo journalctl -u luckyred-api -n 20 --no-pager

# 8. æª¢æŸ¥éŒ¯èª¤
echo "=== æª¢æŸ¥éŒ¯èª¤ ==="
sudo journalctl -u luckyred-api -n 50 --no-pager | grep -i "error\|exception\|traceback" || echo "æœªç™¼ç¾éŒ¯èª¤"
```

---

## ğŸ“‹ é æœŸçµæœ

### å¦‚æœä¸€åˆ‡æ­£å¸¸

1. **æ–‡ä»¶å­˜åœ¨**:
   ```
   -rw-r--r-- 1 ubuntu ubuntu 12345 Nov 27 14:00 api/routers/chats.py
   ```

2. **è·¯ç”±å·²è¨»å†Š**:
   ```
   18:from api.routers import auth, users, redpackets, wallet, checkin, chats
   92:app.include_router(chats.router, prefix="/api/v1/chats", tags=["ç¾¤çµ„"])
   ```

3. **æœå‹™é‹è¡Œ**:
   ```
   Active: active (running)
   ```

4. **æ²’æœ‰éŒ¯èª¤**:
   ```
   æœªç™¼ç¾éŒ¯èª¤
   ```

---

## âš ï¸ å¦‚æœæ–‡ä»¶ä¸å­˜åœ¨

### æª¢æŸ¥ Git ç‹€æ…‹

```bash
cd /opt/luckyred
git status
git log --oneline -5
```

### æª¢æŸ¥é ç¨‹å€‰åº«

```bash
git remote -v
git fetch origin
git log --oneline origin/master -5
```

### å¼·åˆ¶æ›´æ–°

```bash
git fetch origin
git reset --hard origin/master
git clean -fd  # æ¸…ç†æœªè·Ÿè¸ªçš„æ–‡ä»¶
```

---

## ğŸ¯ é©—è­‰æœç´¢åŠŸèƒ½

### æ¸¬è©¦ API ç«¯é»

```bash
curl -X GET "http://localhost:8000/api/v1/chats/search?q=minihb2" \
  -H "Content-Type: application/json"
```

**é æœŸéŸ¿æ‡‰**:
```json
[
  {
    "id": -123456789,
    "title": "@minihb2",
    "type": "group",
    "link": "https://t.me/minihb2"
  }
]
```

---

## ğŸ“ æ³¨æ„äº‹é …

1. **ç›®éŒ„å¾ˆé‡è¦**: å¿…é ˆåœ¨ `/opt/luckyred` ç›®éŒ„ä¸‹åŸ·è¡Œå‘½ä»¤
2. **å‘½ä»¤åˆ†é–‹åŸ·è¡Œ**: ä¸è¦å°‡å¤šå€‹å‘½ä»¤é€£åœ¨ä¸€èµ·
3. **æª¢æŸ¥æ¬Šé™**: æŸäº›å‘½ä»¤éœ€è¦ `sudo` æ¬Šé™
4. **æŸ¥çœ‹æ—¥èªŒ**: å¦‚æœæœå‹™å•Ÿå‹•å¤±æ•—ï¼ŒæŸ¥çœ‹æ—¥èªŒæ‰¾å‡ºåŸå› 

---

**è«‹æŒ‰ç…§ä¸Šè¿°æ­¥é©ŸåŸ·è¡Œï¼Œç¢ºä¿åœ¨æ­£ç¢ºçš„ç›®éŒ„ä¸‹æ“ä½œï¼**

