# ğŸš€ æœåŠ¡å™¨éƒ¨ç½²å‘½ä»¤

## ğŸ“‹ éƒ¨ç½²æ­¥éª¤

### 1. è¿æ¥åˆ°æœåŠ¡å™¨
```bash
ssh root@your-server-ip
```

### 2. è¿›å…¥é¡¹ç›®ç›®å½•
```bash
cd /opt/luckyred
# æˆ–è€…ä½ çš„é¡¹ç›®ç›®å½•
```

### 3. æ‹‰å–æœ€æ–°ä»£ç 
```bash
# å¦‚æœæœ‰æœªæäº¤çš„æ›´æ”¹ï¼Œå…ˆä¿å­˜
git stash

# æ‹‰å–æœ€æ–°ä»£ç 
git pull origin master

# å¦‚æœæœ‰stashï¼Œæ¢å¤æ›´æ”¹ï¼ˆå¯é€‰ï¼‰
git stash pop
```

### 4. å®‰è£…/æ›´æ–°Pythonä¾èµ–
```bash
# APIä¾èµ–
cd /opt/luckyred/api
source .venv/bin/activate  # å¦‚æœä½¿ç”¨è™šæ‹Ÿç¯å¢ƒ
pip install -r requirements.txt
deactivate

# Botä¾èµ–
cd /opt/luckyred/bot
source .venv/bin/activate
pip install -r requirements.txt
deactivate
```

### 5. æ„å»ºå‰ç«¯
```bash
cd /opt/luckyred/frontend
npm install
npm run build
```

### 6. è¿è¡Œæ•°æ®åº“è¿ç§»ï¼ˆå¦‚æœéœ€è¦ï¼‰
```bash
cd /opt/luckyred
python migrations/add_universal_identity_system.py
python migrations/add_ledger_system.py
python migrations/fix_account_links_metadata.py
```

### 7. é‡å¯æœåŠ¡
```bash
# é‡å¯APIæœåŠ¡
systemctl restart luckyred-api

# é‡å¯BotæœåŠ¡
systemctl restart luckyred-bot

# é‡å¯AdminæœåŠ¡ï¼ˆå¦‚æœæœ‰ï¼‰
systemctl restart luckyred-admin

# é‡å¯Nginx
systemctl restart nginx
```

### 8. æ£€æŸ¥æœåŠ¡çŠ¶æ€
```bash
# æ£€æŸ¥APIçŠ¶æ€
systemctl status luckyred-api

# æ£€æŸ¥BotçŠ¶æ€
systemctl status luckyred-bot

# æ£€æŸ¥NginxçŠ¶æ€
systemctl status nginx

# æŸ¥çœ‹APIæ—¥å¿—
journalctl -u luckyred-api -f

# æŸ¥çœ‹Botæ—¥å¿—
journalctl -u luckyred-bot -f
```

## ğŸ”„ ä¸€é”®éƒ¨ç½²è„šæœ¬

å°†ä»¥ä¸‹å‘½ä»¤ä¿å­˜ä¸º `deploy.sh` å¹¶æ‰§è¡Œï¼š

```bash
#!/bin/bash
set -e

echo "ğŸš€ å¼€å§‹éƒ¨ç½²..."

# è¿›å…¥é¡¹ç›®ç›®å½•
cd /opt/luckyred

# æ‹‰å–ä»£ç 
echo "ğŸ“¥ æ‹‰å–æœ€æ–°ä»£ç ..."
git pull origin master

# å®‰è£…APIä¾èµ–
echo "ğŸ“¦ å®‰è£…APIä¾èµ–..."
cd api
source .venv/bin/activate
pip install -r requirements.txt
deactivate
cd ..

# å®‰è£…Botä¾èµ–
echo "ğŸ“¦ å®‰è£…Botä¾èµ–..."
cd bot
source .venv/bin/activate
pip install -r requirements.txt
deactivate
cd ..

# æ„å»ºå‰ç«¯
echo "ğŸ—ï¸ æ„å»ºå‰ç«¯..."
cd frontend
npm install
npm run build
cd ..

# é‡å¯æœåŠ¡
echo "ğŸ”„ é‡å¯æœåŠ¡..."
systemctl restart luckyred-api
systemctl restart luckyred-bot
systemctl restart nginx

echo "âœ… éƒ¨ç½²å®Œæˆï¼"
echo ""
echo "ğŸ“Š æ£€æŸ¥æœåŠ¡çŠ¶æ€ï¼š"
systemctl status luckyred-api --no-pager | head -5
systemctl status luckyred-bot --no-pager | head -5
```

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **ç¯å¢ƒå˜é‡**: ç¡®ä¿ `.env` æ–‡ä»¶å·²æ­£ç¡®é…ç½®
2. **æ•°æ®åº“**: ç¡®ä¿æ•°æ®åº“è¿æ¥æ­£å¸¸
3. **Redis** (å¯é€‰): å¦‚æœä½¿ç”¨Redisï¼Œç¡®ä¿æœåŠ¡æ­£åœ¨è¿è¡Œ
4. **SSLè¯ä¹¦**: ç¡®ä¿SSLè¯ä¹¦æœ‰æ•ˆ
5. **ç«¯å£**: ç¡®ä¿ç«¯å£æœªè¢«å ç”¨

## ğŸ› æ•…éšœæ’æŸ¥

### APIæœåŠ¡æ— æ³•å¯åŠ¨
```bash
# æŸ¥çœ‹è¯¦ç»†æ—¥å¿—
journalctl -u luckyred-api -n 50

# æ£€æŸ¥ç«¯å£å ç”¨
netstat -tlnp | grep 8000
```

### BotæœåŠ¡æ— æ³•å¯åŠ¨
```bash
# æŸ¥çœ‹è¯¦ç»†æ—¥å¿—
journalctl -u luckyred-bot -n 50

# æ£€æŸ¥Bot Token
grep BOT_TOKEN /opt/luckyred/.env
```

### å‰ç«¯æ„å»ºå¤±è´¥
```bash
# æ¸…ç†node_modulesé‡æ–°å®‰è£…
cd /opt/luckyred/frontend
rm -rf node_modules package-lock.json
npm install
npm run build
```

### Nginxé…ç½®é”™è¯¯
```bash
# æµ‹è¯•é…ç½®
nginx -t

# æŸ¥çœ‹é”™è¯¯æ—¥å¿—
tail -f /var/log/nginx/error.log
```

