# 開始執行部署 - 完整指南

## 🚀 立即執行方式

### 方法 1: 雙擊批處理文件（最推薦）

**直接雙擊以下文件**:
```
立即執行部署.bat
```

這個文件會自動執行所有步驟，包括：
- ✅ 檢查關鍵文件是否在 Git 中
- ✅ 自動添加並提交（如果需要）
- ✅ 推送到 GitHub
- ✅ 連接服務器並更新代碼
- ✅ 重啟 API 服務
- ✅ 檢查服務狀態

---

### 方法 2: 在終端中執行

**打開 PowerShell 或 CMD，執行**:
```batch
cd C:\hbgm001
.\立即執行部署.bat
```

---

### 方法 3: 手動執行命令（逐步執行）

#### 步驟 1: 檢查關鍵文件
```powershell
cd C:\hbgm001
git ls-files api/routers/chats.py
git ls-files api/main.py
```

#### 步驟 2: 如果文件不在 Git 中，添加並提交
```powershell
git add api/routers/chats.py api/main.py
git commit -m "feat: 添加群組搜索 API (chats.py)"
git push origin master
```

#### 步驟 3: 更新服務器
```bash
ssh ubuntu@165.154.254.99 "cd /opt/luckyred && git fetch origin && git reset --hard origin/master && ls -la api/routers/chats.py && sudo systemctl restart luckyred-api && sudo systemctl status luckyred-api --no-pager | head -15"
```

---

## 📋 執行流程說明

### 完整流程

1. **檢查關鍵文件**
   - 檢查 `api/routers/chats.py` 是否在 Git 中
   - 檢查 `api/main.py` 是否在 Git 中
   - 如果不在，自動添加並提交

2. **檢查推送狀態**
   - 對比本地和遠程提交
   - 如果不同步，執行推送

3. **服務器文件狀態檢查**
   - 連接到服務器 `165.154.254.99`
   - 檢查關鍵文件是否存在
   - 檢查服務狀態

4. **服務器更新**
   - 更新服務器代碼（`git fetch` + `git reset --hard`）
   - 驗證關鍵文件
   - 重啟 API 服務
   - 檢查服務狀態和錯誤日誌

---

## ✅ 已創建的部署腳本

1. **立即執行部署.bat** - 最簡單版本（推薦）
2. **全自動部署-完整版.ps1** - 完整 PowerShell 腳本
3. **執行全自動部署.bat** - 調用 PowerShell 腳本
4. **執行部署-簡化版.bat** - 簡化版本

---

## 🔧 如果遇到問題

### 問題 1: 無法執行批處理文件

**解決方案**:
- 右鍵點擊文件 → 選擇"以管理員身份運行"
- 或者在終端中手動執行命令

### 問題 2: 無法連接到服務器

**解決方案**:
- 檢查 SSH 連接：`ssh ubuntu@165.154.254.99`
- 確認服務器 IP 地址正確
- 確認 SSH 密鑰或密碼配置正確

### 問題 3: 服務啟動失敗

**解決方案**:
- 查看錯誤日誌：
  ```bash
  ssh ubuntu@165.154.254.99 "sudo journalctl -u luckyred-api -n 50"
  ```
- 檢查 Python 語法
- 檢查導入路徑

---

## 📊 預期結果

### 如果執行成功

1. ✅ 關鍵文件在 Git 中
2. ✅ 本地和遠程已同步
3. ✅ 服務器文件已更新
4. ✅ API 服務正常運行
5. ✅ 搜索功能可以使用

### 驗證方法

**檢查服務器文件**:
```bash
ssh ubuntu@165.154.254.99 "ls -la /opt/luckyred/api/routers/chats.py"
```

**檢查服務狀態**:
```bash
ssh ubuntu@165.154.254.99 "sudo systemctl status luckyred-api"
```

**測試搜索功能**:
- 打開 MiniApp
- 進入"發紅包"頁面
- 點擊"選擇群組"
- 嘗試搜索群組

---

## 🎯 立即開始

**最簡單的方式**: 雙擊 `立即執行部署.bat` 文件

或者執行：
```batch
cd C:\hbgm001
.\立即執行部署.bat
```

---

**準備就緒，可以開始執行部署！**

